<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.js"></script>
    <script>
      // GET https://api.kanye.rest
      // const templateObject = {
      //   person: {
      //     name: "Rodney",
      //     selectedIngredients: [
      //       { name: "Turkey", details: "info" },
      //       { name: "Yam" },
      //       { name: "Pie" },
      //     ],
      //   },
      // };
      // https://www.google.com/search?q=thanksgiving+colors&sxsrf=ALeKk00O8DwdN2upRzp6BVDDhZx57TqlUw:1605646251987&tbm=isch&source=iu&ictx=1&fir=EkU8M1NVqv7W3M%252CENb2SSGL7roorM%252C_&vet=1&usg=AI4_-kSEwpf-97YS9WxlzkcGIYesmmWjtA&sa=X&ved=2ahUKEwiJ6--zuortAhUBnlkKHWgLAO0Q9QF6BAgQEEs#imgrc=9Qga8IJicFgcwM
    </script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <style>
      .individual-name {
        text-align: center;
        border-bottom: 1px solid white;
        padding-bottom: 2px;
      }
      body {
        background-color: #1d2126;
        color: white;
      }

      main.logged-in {
        /* display: flex;
        flex-direction: column;
        justify-content: space-around; */
        background-color: tomato;
      }
      #logged-in-menu,
      #not-logged-in-menu {
        display: flex;
        justify-content: space-around;
        border: 1px solid white;
        border-radius: 10px;
      }

      .ingredients {
        border: 1px dotted black;
        border-radius: 10px;
        display: flex;
        background-color: white;
        align-items: center;
        justify-content: space-around;
        color: black;
      }

      .single-ingredient {
        border: 1px dotted black;
        position: center;
        border-radius: 10px;
        padding: 1.5rem;
      }

      .single-ingredient:hover {
        background-color: rgba(0, 0, 0, 0.1);
      }

      .login {
        width: 70%;
        margin: 20px auto;
        box-shadow: 2px 2px 4px 2px rgba(1, 1, 1, 1);
      }

      .login,
      .form-input {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .form-input {
        margin: 20px 0;
      }
      .add-button {
        background-color: rgba(0, 0, 0, 0.1);
        border: 2px solid brown;
        line-height: 1.2rem;
        font-size: 1.2em;
        border-radius: 50%;
        box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.1);
        color: brown;
      }

      .navigation {
        overflow: hidden;
      }

      .navigation a {
        float: left;
        display: block;
        background-color: white;
        color: black;
        text-align: center;
        padding: 14px 16px;
        border: 1px dotted white;
        border-radius: 10px;
        text-decoration: none;
        font-size: 17px;
      }
      .navigation .icon {
        display: none;
      }

      .navigation a:hover {
        background-color: #dddddd;
        color: black;
      }

      .navigation a.active {
        border: 1px solid white;
        background-color: black;
        color: honeydew;
      }

      @media screen and (max-width: 600px) {
        .navigation a:not(:first-child) {
          display: none;
        }
        .navigation a.icon {
          float: right;
          display: block;
        }
      }

      @media screen and (max-width: 600px) {
        .navigation.responsive {
          position: relative;
        }
        .navigation.responsive .icon {
          position: absolute;
          right: 0;
          top: 0;
        }
        .navigation.responsive a {
          float: none;
          display: block;
          text-align: left;
        }
      }

      #flash-message {
        display: flex;
        justify-content: space-around;
        align-items: center;
        margin-top: 5px;
        border: 1px solid black;
        background-color: white;
        color: black;
        border-radius: 10px;
      }

      #flash-message h4 {
        padding: 4px;
        border: 1px dotted black;
        color: white;
        background-color: darkorange;
        border-radius: 10px;
      }
      .add-button:hover {
        background-color: darkorange;
      }
    </style>
  </head>
  <body>
    <header></header>
    <main></main>
    <footer></footer>
    <script type="text/x-handlebars" id="headerTemplate">
      <nav class="navigation" id='navigation'>
        {{#if loggedIn}}
          <a class='menu-item active' href="/">Home</a>
          <a class='menu-item'href="/profile">{{person.name}}'s Profile</a>
          <a class='menu-item' href="/photos">Submissions</a>
          <a class='menu-item' href="/logout">Create A New Account</a>
        {{else}}
            <a class='menu-item active' href="/" class='menu-link'>Sign In</a>
            <a class='menu-item' href="/create-account" class='menu-link'>Create A New Account</a>
        {{/if}}
          <a href="javascript:void(0)" class='icon' onclick="toggleMenu()">
            <i class='fa fa-bars'></i>
          </a>
      </nav>
    </script>

    <script>
      function toggleMenu() {
        let nav = document.getElementById("navigation");
        nav.classList.toggle("responsive");
      }
    </script>
    <script type="text/x-handlebars" id="mainTemplate">
      {{#if flash}}
        <section id='flash-message'>
          <h4>{{flash.message}}</h4>
          <h4>{{flash.action}}</h4>
        </section>
      {{/if}}
      {{#if person}}
        <h1 class='section-heading'>What would you like to do?</h1>
        <blockquote class='individual-name'>{{person.name}}</blockquote>
        <section class='ingredients'>
          {{#each person.selectedIngredients}}
            <p class='single-ingredient'>{{name}}</p>
          {{/each}}
        </section>
        <section class='add-ingredient'>
          <form id='add-ingredients-form' action="/add/ingredient" method="POST">
            <section class='form-input'>
              <label for="ingredient">Add Ingredient:</label>
              <input id="add-ingredient" name="ingredient" type="text" value='name'>
            </section>
            <section class='form-input'>
              <button type="submit" class='add-button'>+</button>
            </section>
          </form>
        </section>
        <section class='ingredients'>
          <h2 class='section-heading'>Random Ingredients</h2>
          {{#if person.randomIngredients}}
            {{#each person.randomIngredients}}
              <p class='single-ingredient'>{{name}}</p>
            {{/each}}
          {{else}}
            <form id='random-ingredients' action="/add/random/ingredients" method='POST'>
              <button id='assign-ingredients' type='submit'>Get Random Ingredients!</button>
            </form>
          {{/if}}
        </section>
      {{/if }}
    </script>
    <script id="loginTemplate" type="text/x-handlebars">
      <section class='login'>
        <form id='login-form' action="/login" method="POST">
          <section class='form-input'>
            <label for="username">Username:</label>
            <input id="username" name="username" type="text">
          </section>
          <section class='form-input'>
            <label for="password">Password:</label>
            <input id="password" name="password" type="password">
          </section>
          <section class='form-input'>
            <button type="submit" id="login-button">Login</button>
          </section>
        </form>

        <a href="#">Create Account</a>
      </section>
    </script>

    <h1>Hello, World</h1>

    <script>
      const mainTemplate = Handlebars.compile($("#mainTemplate").html());
      const headerTemplate = Handlebars.compile($("#headerTemplate").html());
      const loginTemplate = Handlebars.compile($("#loginTemplate").html());
      let current = {};
      function refresh(scope) {
        if (scope === "header") {
          $("header").html(headerTemplate(current));
        } else if (scope === "main") {
          if (current["loggedIn"]) {
            $("main").addClass("logged-in").html(mainTemplate(current));
          } else {
            $("main").removeClass("logged-in").html(loginTemplate(current));
          }
        } else if (scope === undefined) {
          refresh("header");
          refresh("main");
        }
      }

      function getRandomIngredients(event) {
        let form = document.querySelector("#random-ingredients");
        event.preventDefault();
        let xhr = new XMLHttpRequest();
        xhr.open("POST", "/add/random/ingredients");
        xhr.responseType = "json";
        xhr.addEventListener("load", (event) => {
          let response = JSON.parse(xhr.response);
          current.flash = {message:" here are your random ingredients!", action: "now, you can make a dish"};
          current.person.randomIngredients = response.randomIngredients;
          console.log(xhr)

          refresh('main');
          current.flash = null;
        });
        
        xhr.send();
      }

      function submitIngredient(event) {
        let form = document.querySelector("#add-ingredients-form");
          event.preventDefault();
          let data = new FormData(form);
          let xhr = new XMLHttpRequest();
          xhr.open("POST", "/add/ingredient");
          xhr.responseType = "json";
          xhr.addEventListener("load", (event) => {
            let response = JSON.parse(xhr.response);
            current.person.selectedIngredients.push(response.ingredient)
            current.flash = response.flash
            current.chosenIngredients = true;
            refresh();
            current.flash = null;
          });
          xhr.send(data);
      };

      refresh();

      document.addEventListener("DOMContentLoaded", () => {
        // loggedIn = null;
        let $form = $("#login-form");
        $(document).submit(function (event) {
          event.preventDefault();
          if (event.target.id === 'login-form') {

            let login = new XMLHttpRequest();
            login.responseType = "json";
            login.open("POST", "/login");
            login.addEventListener("load", (event) => {
              let response = login.response;
              current = JSON.parse(response);
              // current["loggedIn"] = loggedIn.loggedIn;
              // console.log(current["loggedIn"]);
              // current.person.hasIngredients = true;
              // current.person.selectedIngredients = [];
              // --------- Checking for random ingredients -------
              // current.person.randomIngredients = [
              //   { name: "apple" },
              //   { name: "pie" },
              // ];

              refresh();
              current.flash = null;
            });
            let data = new FormData($form[0]);
            login.send(data);
          } else if (event.target.id === 'add-ingredients-form') {
            submitIngredient(event);
          } else if (event.target.id === 'random-ingredients') {
            getRandomIngredients(event);
          }
        });
      });
        </script>
    </body>

  </html>

    </script>
  </body>
</html>
